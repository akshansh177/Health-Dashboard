<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACS Health Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><i class="fas fa-heartbeat mr-2"></i><strong>ACS</strong> Health</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="main-nav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item"><a class="nav-link active" id="nav-dashboard" href="#">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" id="nav-records" href="#">Patient Records</a></li>
                    <li class="nav-item"><a class="nav-link" id="nav-demographics" href="#">Demographics</a></li>
                    <li class="nav-item"><a class="nav-link" id="nav-lab" href="#">Lab</a></li>
                    <li class="nav-item"><a class="nav-link" id="nav-logbook" href="#">Logbook</a></li>
                    <li class="nav-item"><a class="nav-link" id="nav-medicine" href="#">Medicine</a></li>
                    <li class="nav-item"><a class="nav-link" id="nav-reports" href="#">Reports</a></li>
                    <li class="nav-item"><a class="nav-link" id="nav-activity-log" href="#">Activity Log</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container-fluid mt-4">

        <div id="page-dashboard">
             <div class="row" id="dashboard-stats">
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card stat-card h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="stat-icon bg-info text-white"><i class="fas fa-users"></i></div>
                                <div class="ml-3">
                                    <h6 class="card-subtitle text-muted font-weight-bold">Total Patients</h6>
                                    <h3 class="card-title mb-0" id="stat-total-patients">0</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card stat-card h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="stat-icon bg-success text-white"><i class="fas fa-calendar-check"></i></div>
                                <div class="ml-3">
                                    <h6 class="card-subtitle text-muted font-weight-bold">Visits This Month</h6>
                                    <h3 class="card-title mb-0" id="stat-visits-month">0</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card stat-card h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="stat-icon bg-danger text-white"><i class="fas fa-pills"></i></div>
                                <div class="ml-3">
                                    <h6 class="card-subtitle text-muted font-weight-bold">Low Stock Medicines</h6>
                                    <h3 class="card-title mb-0" id="stat-low-stock">0</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 mb-4">
                    <div class="card h-100"><div class="card-body">
                        <h5 class="card-title"><i class="fas fa-user-plus mr-2 text-primary"></i>Add New Patient</h5>
                        <hr>
                        <form id="add-patient-form">
                            <div class="form-group"><label>Date of Visit</label><input type="date" class="form-control form-control-sm" id="registration_date" required></div>
                            <div class="form-group"><label>Name</label><input type="text" class="form-control form-control-sm" id="name" required></div>
                            <div class="form-group"><label>Husband/Father's Name</label><input type="text" class="form-control form-control-sm" id="husband_father_name"></div>
                            <div class="form-row">
                                <div class="form-group col-md-6"><label>Age</label><input type="number" class="form-control form-control-sm" id="age"></div>
                                <div class="form-group col-md-6"><label>Sex</label><select id="sex" class="form-control form-control-sm"><option>Male</option><option>Female</option></select></div>
                            </div>
                            <div class="form-group"><label>Caste</label><select id="caste" class="form-control form-control-sm"><option value="General">General</option><option value="OBC">OBC</option><option value="SC/ST">SC/ST</option><option value="Others">Others</option></select></div>
                            <div class="form-group"><label>BPL Status</label><select id="bpl_status" class="form-control form-control-sm"><option value="No">No</option><option value="Yes">Yes</option></select></div>
                            <div class="form-group"><label>Village</label><input type="text" class="form-control form-control-sm" id="village_name" required></div>
                            <div class="form-group"><label>Program</label><select id="program_type" class="form-control form-control-sm"><option value="General">General</option><option value="HTN">HTN</option><option value="DM">DM</option><option value="ANC">ANC</option><option value="PNC">PNC</option><option value="CATARACT">Cataract</option></select></div>
                            
                            <div id="anc-details-container" class="d-none mt-3 border-top pt-3">
                                <h6>Additional ANC Details</h6>
                                <div class="form-group"><label>GPAL</label><input type="text" id="anc_gpal" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Albumin</label><input type="text" id="anc_albumin" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>TT</label><input type="text" id="anc_tt" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>FHR</label><input type="text" id="anc_fhr" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Gestational age</label><input type="text" id="anc_gestational_age" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>FP</label><input type="text" id="anc_fp" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Contact</label><input type="text" id="anc_contact" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Remark</label><textarea id="anc_remark" class="form-control form-control-sm" rows="2"></textarea></div>
                            </div>

                            <div id="pnc-details-container" class="d-none mt-3 border-top pt-3">
                                <h6>Additional PNC Details</h6>
                                <div class="form-group"><label>PNC Duration</label><input type="text" id="pnc_duration" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Mother Weight (Kg)</label><input type="number" step="0.1" id="pnc_mother_weight" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Child Weight (Kg)</label><input type="number" step="0.1" id="pnc_child_weight" class="form-control form-control-sm"></div>
                            </div>
                            
                            <div class="form-check mt-3"><input class="form-check-input" type="checkbox" id="add-follow-up-checkbox"><label class="form-check-label" for="add-follow-up-checkbox">Add Follow-up Details</label></div>
                            <button type="submit" class="btn btn-primary btn-block mt-3"><i class="fas fa-plus-circle mr-2"></i>Add Patient</button>
                        </form>
                    </div></div>
                </div>
                <div class="col-lg-9">
                    <div class="card h-100"><div class="card-body">
                        <h5 class="card-title"><i class="fas fa-chart-bar mr-2 text-primary"></i>Patient Visit Report</h5>
                        <hr>
                        <div class="row bg-light p-3 mb-3 rounded">
                            <div class="col-md-3"><div class="form-group"><label>Start Date</label><input type="date" id="filter-start-date" class="form-control form-control-sm"></div><div class="form-group mb-md-0"><label>End Date</label><input type="date" id="filter-end-date" class="form-control form-control-sm"></div></div>
                            <div class="col-md-3"><label>Villages</label><div id="filter-village-checkboxes" class="checkbox-container"></div></div>
                            <div class="col-md-3"><label>Programs</label><div id="filter-program-checkboxes" class="checkbox-container"></div></div>
                            <div class="col-md-2"><label>Caste</label><div id="filter-caste-checkboxes" class="checkbox-container"></div></div>
                            <div class="col-md-1 d-flex align-items-end"><button id="generate-report-btn" class="btn btn-primary btn-block btn-sm mt-3">Filter</button></div>
                        </div>
                        <div id="report-results">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    Total Visits: <span id="total-visits-count" class="badge badge-pill badge-primary ml-1">0</span>
                                    <span class="mx-2">|</span>
                                    Unique Patients: <span id="unique-patient-count" class="badge badge-pill badge-info ml-1">0</span>
                                    <span class="mx-2">|</span>
                                    Follow-up Visits: <span id="follow-up-visits-count" class="badge badge-pill badge-secondary ml-1">0</span>
                                </h6>
                                <button id="export-excel-btn" class="btn btn-success btn-sm" disabled><i class="fas fa-file-excel mr-1"></i>Export</button>
                            </div>
                            <hr class="mt-2">
                            <div id="report-table-container" class="table-responsive"><p class="text-muted text-center">Select filters and click "Filter".</p></div>
                        </div>
                    </div></div>
                </div>
            </div>

            <div class="row mt-4"><div class="col-12"><div class="card"><div class="card-body">
                <h5 class="card-title"><i class="fas fa-notes-medical mr-2 text-primary"></i>Add Monthly Follow-up</h5><hr>
                <form id="add-follow-up-form">
                    <div class="form-row">
                        <div class="form-group col-md-4"><label>Select Patient</label><select id="fu-patient-id" class="form-control form-control-sm" required><option value="">-- Please Select --</option></select></div>
                        <div class="form-group col-md-2"><label>Follow-up Date</label><input type="date" id="fu-date" class="form-control form-control-sm" required></div>
                    </div>
                    <h6 class="mt-3">Vitals</h6><hr class="mt-1 mb-2">
                    <div class="form-row">
                        <div class="form-group col-md-2"><label>Pulse</label><input type="text" id="fu-pulse" class="form-control form-control-sm"></div>
                        <div class="form-group col-md-2"><label>Resp. Rate</label><input type="text" id="fu-respiratory-rate" class="form-control form-control-sm"></div>
                        <div class="form-group col-md-2"><label>Temperature</label><input type="text" id="fu-temperature" class="form-control form-control-sm"></div>
                        <div class="form-group col-md-2"><label>Blood Pressure</label><input type="text" id="fu-blood-pressure" class="form-control form-control-sm"></div>
                        <div class="form-group col-md-2"><label>Weight (Kg)</label><input type="number" step="0.1" id="fu-weight" class="form-control form-control-sm"></div>
                        <div class="form-group col-md-2"><label>Height (cm)</label><input type="number" step="0.1" id="fu-height" class="form-control form-control-sm"></div>
                    </div>
                    <h6 class="mt-3">History & Notes</h6><hr class="mt-1 mb-2">
                    <div class="form-row">
                        <div class="form-group col-md-3"><label>Known Case Of (K/C/O)</label><textarea id="fu-kco" class="form-control form-control-sm" rows="2"></textarea></div>
                        <div class="form-group col-md-3"><label>History Of (H/O)</label><textarea id="fu-ho" class="form-control form-control-sm" rows="2"></textarea></div>
                        <div class="form-group col-md-3"><label>Complaint Of (C/O)</label><textarea id="fu-co" class="form-control form-control-sm" rows="2"></textarea></div>
                        <div class="form-group col-md-3"><label>On Examination (O/E)</label><textarea id="fu-oe" class="form-control form-control-sm" rows="2"></textarea></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-4"><label>Treatment Advised</label><textarea id="fu-treatment" class="form-control form-control-sm" rows="2"></textarea></div>
                        <div class="form-group col-md-4">
                            <label>Medicine Prescribed</label>
                            <div class="input-group">
                                <select id="fu-medicine-select" class="form-control form-control-sm"></select>
                                <input type="number" id="fu-medicine-quantity" class="form-control form-control-sm" placeholder="Qty" style="max-width: 70px;">
                                <div class="input-group-append">
                                    <button type="button" id="add-medicine-to-fu-btn" class="btn btn-sm btn-secondary">Add</button>
                                </div>
                            </div>
                            <ul id="fu-prescription-list" class="list-unstyled mt-2"></ul>
                            <input type="hidden" id="fu-medicine">
                            <small class="form-text text-muted">Select medicine, enter quantity, and click Add.</small>
                        </div>
                        <div class="form-group col-md-4"><label>Follow-up Notes</label><textarea id="fu-follow-up-notes" class="form-control form-control-sm" rows="2"></textarea></div>
                    </div>
                    <h6 class="mt-3">ANC / PNC / Child</h6><hr class="mt-1 mb-2">
                    <div class="form-row">
                        <div class="form-group col-md-2"><label>LMP</label><input type="date" id="fu-lmp" class="form-control form-control-sm"></div>
                        <div class="form-group col-md-2"><label>EDD</label><input type="date" id="fu-edd" class="form-control form-control-sm"></div>
                        <div class="form-group col-md-2"><label>Heartbeat</label><input type="text" id="fu-heartbeat" class="form-control form-control-sm"></div>
                        <div class="form-group col-md-2"><label>RBS</label><input type="text" id="fu-rbs" class="form-control form-control-sm"></div>
                        <div class="form-group col-md-1"><label>Hb</label><input type="text" id="fu-hb" class="form-control form-control-sm"></div>
                        <div class="form-group col-md-1"><label>Urine Sugar</label><input type="text" id="fu-urine-sugar" class="form-control form-control-sm"></div>
                        <div class="form-group col-md-2"><label>Urine Albumin</label><input type="text" id="fu-urine-albumin" class="form-control form-control-sm"></div>
                    </div>
                    <button type="submit" class="btn btn-success btn-lg float-right"><i class="fas fa-save mr-2"></i>Save Follow-up</button>
                </form>
            </div></div></div></div>

            <div class="row mt-4"><div class="col-12"><div class="card"><div class="card-body">
                <h5 class="card-title"><i class="fas fa-map-marked-alt mr-2 text-primary"></i>Village Summary Report</h5><hr>
                <div class="form-row bg-light p-3 mb-3 rounded align-items-end">
                    <div class="form-group col-md-3"><label>Start Date</label><input type="date" id="summary-start-date" class="form-control form-control-sm"></div>
                    <div class="form-group col-md-3"><label>End Date</label><input type="date" id="summary-end-date" class="form-control form-control-sm"></div>
                    <div class="form-group col-md-3"><button id="generate-summary-btn" class="btn btn-primary btn-block btn-sm">Generate</button></div>
                    <div class="form-group col-md-3"><button id="export-summary-btn" class="btn btn-success btn-block btn-sm" disabled><i class="fas fa-file-excel mr-1"></i>Export</button></div>
                </div>
                <div id="summary-table-container" class="table-responsive"><p class="text-muted text-center">Select a date range and click "Generate".</p></div>
            </div></div></div></div>
        </div>

        <div id="page-records" class="d-none">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="card-title mb-0"><i class="fas fa-book-medical mr-2 text-primary"></i>All Patient Records</h5>
                                <div>
                                    <button id="export-records-btn" class="btn btn-success btn-sm"><i class="fas fa-file-excel mr-1"></i>Export List</button>
                                    <button id="export-records-details-btn" class="btn btn-info btn-sm ml-2"><i class="fas fa-file-download mr-1"></i>Export All Details</button>
                                </div>
                            </div>
                            <hr>
                            <div class="row bg-light p-3 mb-4 rounded align-items-end">
                                <div class="form-group col-md-4 mb-md-0">
                                    <label>Search by Name</label>
                                    <input type="text" id="records-search-input" class="form-control form-control-sm" placeholder="Enter patient name...">
                                </div>
                                <div class="form-group col-md-3 mb-md-0">
                                    <label>Registration Start Date</label>
                                    <input type="date" id="records-start-date" class="form-control form-control-sm">
                                </div>
                                <div class="form-group col-md-3 mb-md-0">
                                    <label>Registration End Date</label>
                                    <input type="date" id="records-end-date" class="form-control form-control-sm">
                                </div>
                                <div class="col-md-2">
                                    <button id="records-filter-btn" class="btn btn-primary btn-block btn-sm">Search</button>
                                </div>
                            </div>
                            <div id="records-table-container" class="table-responsive">
                                <p class="text-muted text-center">Loading records...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Patient Details Modal -->
        <div class="modal fade" id="patient-details-modal" tabindex="-1" role="dialog" aria-labelledby="patientDetailsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="patientDetailsModalLabel">Patient Details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- Content will be injected by JavaScript -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Edit Patient Modal -->
        <div class="modal fade" id="edit-patient-modal" tabindex="-1" role="dialog" aria-labelledby="editPatientModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editPatientModalLabel">Edit Patient Details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-patient-form">
                            <input type="hidden" id="edit-patient-id">
                            <h6>Basic Information</h6>
                            <div class="form-group"><label>Registration Date</label><input type="date" class="form-control form-control-sm" id="edit-registration-date" required></div>
                            <div class="form-group"><label>Name</label><input type="text" class="form-control form-control-sm" id="edit-name" required></div>
                            <div class="form-group"><label>Husband/Father's Name</label><input type="text" class="form-control form-control-sm" id="edit-husband-father-name"></div>
                            <div class="form-row">
                                <div class="form-group col-md-6"><label>Age</label><input type="number" class="form-control form-control-sm" id="edit-age"></div>
                                <div class="form-group col-md-6"><label>Sex</label><select id="edit-sex" class="form-control form-control-sm"><option>Male</option><option>Female</option></select></div>
                            </div>
                            <div class="form-group"><label>Caste</label><select id="edit-caste" class="form-control form-control-sm"><option value="General">General</option><option value="OBC">OBC</option><option value="SC/ST">SC/ST</option><option value="Others">Others</option></select></div>
                            <div class="form-group"><label>BPL Status</label><select id="edit-bpl-status" class="form-control form-control-sm"><option value="No">No</option><option value="Yes">Yes</option></select></div>
                            <div class="form-group"><label>Village</label><input type="text" class="form-control form-control-sm" id="edit-village-name" required></div>
                            <div class="form-group"><label>Program</label><select id="edit-program-type" class="form-control form-control-sm"><option value="General">General</option><option value="HTN">HTN</option><option value="DM">DM</option><option value="ANC">ANC</option><option value="PNC">PNC</option><option value="CATARACT">Cataract</option></select></div>
                            
                            <div id="edit-anc-details-container" class="d-none mt-3 pt-3 border-top">
                                <h6>Edit ANC Details</h6>
                                <div class="form-group"><label>GPAL</label><input type="text" id="edit-anc-gpal" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Albumin</label><input type="text" id="edit-anc-albumin" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>TT</label><input type="text" id="edit-anc-tt" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>FHR</label><input type="text" id="edit-anc-fhr" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Gestational age</label><input type="text" id="edit-anc-gestational-age" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>FP</label><input type="text" id="edit-anc-fp" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Contact</label><input type="text" id="edit-anc-contact" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Remark</label><textarea id="edit-anc-remark" class="form-control form-control-sm" rows="2"></textarea></div>
                            </div>

                            <div id="edit-pnc-details-container" class="d-none mt-3 pt-3 border-top">
                                <h6>Edit PNC Details</h6>
                                <div class="form-group"><label>PNC Duration</label><input type="text" id="edit-pnc-duration" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Mother Weight (Kg)</label><input type="number" step="0.1" id="edit-pnc-mother-weight" class="form-control form-control-sm"></div>
                                <div class="form-group"><label>Child Weight (Kg)</label><input type="number" step="0.1" id="edit-pnc-child-weight" class="form-control form-control-sm"></div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" form="edit-patient-form" class="btn btn-primary">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Follow-up Modal -->
        <div class="modal fade" id="edit-follow-up-modal" tabindex="-1" role="dialog" aria-labelledby="editFollowUpModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editFollowUpModalLabel">Edit Follow-up</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-follow-up-form">
                            <input type="hidden" id="edit-fu-id">
                            <input type="hidden" id="edit-fu-patient-id">
                            <div class="form-group">
                                <label>Follow-up Date</label>
                                <input type="date" id="edit-fu-date" class="form-control form-control-sm" required>
                            </div>
                            <h6 class="mt-3">Vitals</h6><hr class="mt-1 mb-2">
                            <div class="form-row">
                                <div class="form-group col-md-2"><label>Pulse</label><input type="text" id="edit-fu-pulse" class="form-control form-control-sm"></div>
                                <div class="form-group col-md-2"><label>Resp. Rate</label><input type="text" id="edit-fu-respiratory-rate" class="form-control form-control-sm"></div>
                                <div class="form-group col-md-2"><label>Temperature</label><input type="text" id="edit-fu-temperature" class="form-control form-control-sm"></div>
                                <div class="form-group col-md-2"><label>Blood Pressure</label><input type="text" id="edit-fu-blood-pressure" class="form-control form-control-sm"></div>
                                <div class="form-group col-md-2"><label>Weight (Kg)</label><input type="number" step="0.1" id="edit-fu-weight" class="form-control form-control-sm"></div>
                                <div class="form-group col-md-2"><label>Height (cm)</label><input type="number" step="0.1" id="edit-fu-height" class="form-control form-control-sm"></div>
                            </div>
                            <h6 class="mt-3">History & Notes</h6><hr class="mt-1 mb-2">
                            <div class="form-row">
                                <div class="form-group col-md-3"><label>Known Case Of (K/C/O)</label><textarea id="edit-fu-kco" class="form-control form-control-sm" rows="2"></textarea></div>
                                <div class="form-group col-md-3"><label>History Of (H/O)</label><textarea id="edit-fu-ho" class="form-control form-control-sm" rows="2"></textarea></div>
                                <div class="form-group col-md-3"><label>Complaint Of (C/O)</label><textarea id="edit-fu-co" class="form-control form-control-sm" rows="2"></textarea></div>
                                <div class="form-group col-md-3"><label>On Examination (O/E)</label><textarea id="edit-fu-oe" class="form-control form-control-sm" rows="2"></textarea></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-4"><label>Treatment Advised</label><textarea id="edit-fu-treatment" class="form-control form-control-sm" rows="2"></textarea></div>
                                 <div class="form-group col-md-4">
                                    <label>Medicine Prescribed</label>
                                    <div class="input-group">
                                        <select id="edit-fu-medicine-select" class="form-control form-control-sm"></select>
                                        <input type="number" id="edit-fu-medicine-quantity" class="form-control form-control-sm" placeholder="Qty" style="max-width: 70px;">
                                        <div class="input-group-append">
                                            <button type="button" id="add-medicine-to-edit-fu-btn" class="btn btn-sm btn-secondary">Add</button>
                                        </div>
                                    </div>
                                    <ul id="edit-fu-prescription-list" class="list-unstyled mt-2"></ul>
                                    <input type="hidden" id="edit-fu-medicine">
                                    <small class="form-text text-muted">Select medicine, enter quantity, and click Add.</small>
                                </div>
                                <div class="form-group col-md-4"><label>Follow-up Notes</label><textarea id="edit-fu-follow-up-notes" class="form-control form-control-sm" rows="2"></textarea></div>
                            </div>
                            <h6 class="mt-3">ANC / PNC / Child</h6><hr class="mt-1 mb-2">
                            <div class="form-row">
                                <div class="form-group col-md-2"><label>LMP</label><input type="date" id="edit-fu-lmp" class="form-control form-control-sm"></div>
                                <div class="form-group col-md-2"><label>EDD</label><input type="date" id="edit-fu-edd" class="form-control form-control-sm"></div>
                                <div class="form-group col-md-2"><label>Heartbeat</label><input type="text" id="edit-fu-heartbeat" class="form-control form-control-sm"></div>
                                <div class="form-group col-md-2"><label>RBS</label><input type="text" id="edit-fu-rbs" class="form-control form-control-sm"></div>
                                <div class="form-group col-md-1"><label>Hb</label><input type="text" id="edit-fu-hb" class="form-control form-control-sm"></div>
                                <div class="form-group col-md-1"><label>Urine Sugar</label><input type="text" id="edit-fu-urine-sugar" class="form-control form-control-sm"></div>
                                <div class="form-group col-md-2"><label>Urine Albumin</label><input type="text" id="edit-fu-urine-albumin" class="form-control form-control-sm"></div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" form="edit-follow-up-form" class="btn btn-primary">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Full Follow-up Details Modal -->
        <div class="modal fade" id="follow-up-details-modal" tabindex="-1" role="dialog" aria-labelledby="followUpDetailsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="followUpDetailsModalLabel">Full Follow-up Record</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" id="full-follow-up-details-content">
                        <!-- Details will be injected here by JavaScript -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Lab Record Modal -->
        <div class="modal fade" id="edit-lab-record-modal" tabindex="-1" role="dialog" aria-labelledby="editLabRecordModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editLabRecordModalLabel">Edit Lab Record</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-lab-record-form">
                            <input type="hidden" id="edit-lab-record-id">
                            <div class="form-row">
                                <div class="form-group col-md-6"><label>Test Date</label><input type="date" id="edit-lab-test-date" class="form-control form-control-sm" required></div>
                                <div class="form-group col-md-6">
                                    <label>Test Name</label>
                                    <select id="edit-lab-test-name" class="form-control form-control-sm" required>
                                        <option>M.P (Malaria Parasite)</option>
                                        <option>H.B (Hemoglobin)</option>
                                        <option>R.B.S (Random Blood Sugar)</option>
                                        <option>H.B/R.B.S</option>
                                        <option>Urine Albumin</option>
                                        <option>U.P.T (Urine Pregnancy Test)</option>
                                        <option>VDRL</option>
                                        <option>BTCT (Bleeding Time Cloating Time)</option>
                                        <option>SPUTUM</option>
                                        <option>H.B/R.B.S/ALBUMIN</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label>Positive Reading (Optional)</label>
                                    <input type="text" id="edit-lab-positive-reading" class="form-control form-control-sm">
                                </div>
                                <div class="form-group col-md-6">
                                    <label>Negative Reading (Optional)</label>
                                    <input type="text" id="edit-lab-negative-reading" class="form-control form-control-sm">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" form="edit-lab-record-form" class="btn btn-primary">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>


        <div id="page-demographics" class="d-none">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0"><i class="fas fa-users mr-2 text-primary"></i>Patient Demographics Report</h5>
                                <button id="export-demographics-btn" class="btn btn-success btn-sm"><i class="fas fa-file-excel mr-1"></i>Export Demographics</button>
                            </div>
                            <hr>
                            <div id="demographics-table-container" class="table-responsive">
                                <p class="text-muted text-center">Loading report...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-lab" class="d-none">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                             <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0"><i class="fas fa-vial mr-2 text-primary"></i>Lab Records</h5>
                                <button id="export-lab-btn" class="btn btn-success btn-sm"><i class="fas fa-file-excel mr-1"></i>Export Lab Records</button>
                            </div>
                            <hr>
                            <div class="card bg-light mb-4">
                                <div class="card-body">
                                    <h6 class="card-title">Add New Lab Test</h6>
                                    <form id="add-lab-record-form">
                                        <div class="form-row align-items-end">
                                            <div class="form-group col-md-4">
                                                <label>Select Patient</label>
                                                <select id="lab-patient-id" class="form-control form-control-sm" required>
                                                    <option value="">-- Please Select --</option>
                                                </select>
                                            </div>
                                            <div class="form-group col-md-2"><label>Test Date</label><input type="date" id="lab-test-date" class="form-control form-control-sm" required></div>
                                            <div class="form-group col-md-3">
                                                <label>Test Name</label>
                                                <select id="lab-test-name" class="form-control form-control-sm" required>
                                                    <option>M.P (Malaria Parasite)</option>
                                                    <option>H.B (Hemoglobin)</option>
                                                    <option>R.B.S (Random Blood Sugar)</option>
                                                    <option>H.B/R.B.S</option>
                                                    <option>Urine Albumin</option>
                                                    <option>U.P.T (Urine Pregnancy Test)</option>
                                                    <option>VDRL</option>
                                                    <option>BTCT (Bleeding Time Cloating Time)</option>
                                                    <option>SPUTUM</option>
                                                    <option>H.B/R.B.S/ALBUMIN</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row mt-2">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>Positive Reading (Optional)</label>
                                                    <input type="text" id="lab-positive-reading" class="form-control form-control-sm">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>Negative Reading (Optional)</label>
                                                    <input type="text" id="lab-negative-reading" class="form-control form-control-sm">
                                                </div>
                                            </div>
                                        </div>
                                        <div id="lab-patient-details" class="mt-2 p-2 bg-white rounded border d-none">
                                            </div>
                                        <button type="submit" class="btn btn-primary mt-3 float-right"><i class="fas fa-save mr-2"></i>Save Test Result</button>
                                    </form>
                                </div>
                            </div>
                            
                            <!-- Filtering Section -->
                            <div class="row bg-light p-3 mb-4 rounded align-items-end">
                                <div class="form-group col-md-3 mb-md-0">
                                    <label>Start Date</label>
                                    <input type="date" id="lab-filter-start-date" class="form-control form-control-sm">
                                </div>
                                <div class="form-group col-md-3 mb-md-0">
                                    <label>End Date</label>
                                    <input type="date" id="lab-filter-end-date" class="form-control form-control-sm">
                                </div>
                                <div class="col-md-2">
                                    <button id="lab-filter-btn" class="btn btn-primary btn-block btn-sm">Filter</button>
                                </div>
                            </div>

                            <div id="lab-table-container" class="table-responsive mt-4">
                                <p class="text-muted text-center">Loading lab records...</p>
                            </div>
                            
                            <!-- Lab Count Section -->
                            <hr class="my-5">
                            <div class="mt-4">
                                <h5 class="card-title"><i class="fas fa-chart-pie mr-2 text-primary"></i>Lab Test Count Report</h5>
                                <hr>
                                <div class="row bg-light p-3 mb-3 rounded align-items-end">
                                    <div class="form-group col-md-3"><label>Start Date</label><input type="date" id="lab-count-start-date" class="form-control form-control-sm"></div>
                                    <div class="form-group col-md-3"><label>End Date</label><input type="date" id="lab-count-end-date" class="form-control form-control-sm"></div>
                                    <div class="form-group col-md-2"><button id="generate-lab-count-btn" class="btn btn-primary btn-block btn-sm">Generate</button></div>
                                    <div class="form-group col-md-2"><button id="export-lab-count-btn" class="btn btn-success btn-block btn-sm" disabled><i class="fas fa-file-excel mr-1"></i>Export Stats</button></div>
                                </div>
                                <div id="lab-count-table-container" class="table-responsive"><p class="text-muted text-center">Select a date range and click "Generate".</p></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-logbook" class="d-none">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0"><i class="fas fa-route mr-2 text-primary"></i>Ambulance Logbook</h5>
                                <button id="export-logbook-btn" class="btn btn-success btn-sm"><i class="fas fa-file-excel mr-1"></i>Export Logbook</button>
                            </div>
                            <hr>
                            <div class="card bg-light mb-4">
                                <div class="card-body">
                                    <h6 class="card-title">Add New Log Entry</h6>
                                    <form id="add-logbook-form">
                                        <div class="form-row align-items-end">
                                            <div class="form-group col-md-2"><label>Date</label><input type="date" id="log-date" class="form-control form-control-sm" required></div>
                                            <div class="form-group col-md-1"><label>Time Out</label><input type="time" id="log-time-out" class="form-control form-control-sm"></div>
                                            <div class="form-group col-md-1"><label>Time In</label><input type="time" id="log-time-in" class="form-control form-control-sm"></div>
                                            <div class="form-group col-md-2"><label>Opening KMs</label><input type="number" step="0.1" id="log-kms-opening" class="form-control form-control-sm"></div>
                                            <div class="form-group col-md-2"><label>Closing KMs</label><input type="number" step="0.1" id="log-kms-closing" class="form-control form-control-sm"></div>
                                            <div class="form-group col-md-1"><label>Total KMs</label><input type="text" id="log-total-kms" class="form-control form-control-sm" readonly></div>
                                            <div class="form-group col-md-1"><label>Fuel (L)</label><input type="number" step="0.01" id="log-fuel" class="form-control form-control-sm"></div>
                                        </div>
                                        <div class="form-row mt-2">
                                            <div class="form-group col-12"><label>Villages Visited (comma-separated)</label><input type="text" id="log-villages" class="form-control form-control-sm"></div>
                                        </div>
                                        <button type="submit" class="btn btn-primary mt-3 float-right"><i class="fas fa-save mr-2"></i>Save Log Entry</button>
                                    </form>
                                </div>
                            </div>
                            <div id="logbook-table-container" class="table-responsive mt-4">
                                <p class="text-muted text-center">Loading logbook...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-medicine" class="d-none">
             <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0"><i class="fas fa-pills mr-2 text-primary"></i>Medicine Inventory</h5>
                                <button id="export-medicine-btn" class="btn btn-success btn-sm"><i class="fas fa-file-excel mr-1"></i>Export Inventory</button>
                            </div>
                            <hr>
                            <form id="add-medicine-form" class="form-inline bg-light p-3 mb-3 rounded">
                                <div class="form-group mx-sm-3 mb-2"><input type="text" class="form-control form-control-sm" id="med-name" placeholder="Medicine Name" required></div>
                                <div class="form-group mx-sm-3 mb-2"><input type="number" class="form-control form-control-sm" id="med-stock" placeholder="Stock Count" required></div>
                                <div class="form-group mx-sm-3 mb-2"><label for="med-expiry" class="sr-only">Expiry</label><input type="date" class="form-control form-control-sm" id="med-expiry" required></div>
                                <button type="submit" class="btn btn-primary btn-sm mb-2"><i class="fas fa-plus mr-1"></i>Add Medicine</button>
                            </form>
                            <div id="medicine-table-container" class="table-responsive"><p class="text-muted text-center">Loading inventory...</p></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div id="page-reports" class="d-none">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs">
                                <li class="nav-item">
                                    <a class="nav-link active" id="nav-cumulative-report" href="#">Cumulative</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link disabled" href="#">Report 2 (Coming Soon)</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link disabled" href="#">Report 3 (Coming Soon)</a>
                                </li>
                                 <li class="nav-item">
                                    <a class="nav-link disabled" href="#">Report 4 (Coming Soon)</a>
                                </li>
                                 <li class="nav-item">
                                    <a class="nav-link disabled" href="#">Report 5 (Coming Soon)</a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div id="report-cumulative">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title mb-0"><i class="fas fa-calendar-alt mr-2 text-primary"></i>Cumulative Report</h5>
                                    <div>
                                        <select id="cumulative-year-select" class="form-control form-control-sm d-inline-block w-auto mr-2"></select>
                                        <button id="export-cumulative-btn" class="btn btn-success btn-sm"><i class="fas fa-file-excel mr-1"></i>Export</button>
                                    </div>
                                </div>
                                <hr>
                                <div id="cumulative-table-container" class="table-responsive">
                                    <p class="text-muted text-center">Select a year to generate the report.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="page-activity-log" class="d-none">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0"><i class="fas fa-history mr-2 text-primary"></i>Activity Log</h5>
                                <button id="refresh-log-btn" class="btn btn-sm btn-secondary"><i class="fas fa-sync-alt mr-1"></i>Refresh</button>
                            </div>
                            <hr>
                            <div id="activity-log-table-container" class="table-responsive">
                                <p class="text-muted text-center">Loading log...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
    
    <!-- Issue Medicine Modal -->
    <div class="modal fade" id="issue-medicine-modal" tabindex="-1" role="dialog" aria-labelledby="issueMedicineModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="issueMedicineModalLabel">Issue Medicine</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="issue-medicine-form">
                        <input type="hidden" id="issue-med-id">
                        <div class="form-group">
                            <label>Medicine Name</label>
                            <input type="text" id="issue-med-name" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>Remaining Quantity</label>
                            <input type="number" id="issue-med-remaining" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label for="issue-med-quantity">Quantity to Issue</label>
                            <input type="number" id="issue-med-quantity" class="form-control" required min="1">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" form="issue-medicine-form" class="btn btn-primary">Issue</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="script.js"></script>
</body>
</html>